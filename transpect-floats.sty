%%
%% This is file `transpect-floats.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% transpect.dtx  (with options: `floats')
%% 
%% IMPORTANT NOTICE:
%% 
%% For the copyright see the source file.
%% 
%% Any modified versions of this file must be renamed
%% with new filenames distinct from transpect-floats.sty.
%% 
%% For distribution of the original source see the terms
%% for copying and modification in the file transpect.dtx.
%% 
%% This generated file may be distributed as long as the
%% original source files, as listed above, are part of the
%% same distribution. (The sources need not necessarily be
%% in the same archive or directory.)
\def\fileversion{0.97}%
\def\filedate{2021-02-25}%
%%
%% module for le-tex transpect.cls that extends floating objects.
%%
%% Maintainer: p.schulz@le-tex.de
%%
%% lualatex  -  texlive > 2019
%%
\NeedsTeXFormat{LaTeX2e}[2019/01/01]
\ProvidesPackage{transpect-floats}
    [2020/22/04 0.90 le-tex transpect floats module]
\usepackage{tabularx}
\usepackage{multirow}
\usepackage{caption}
\newcolumntype{Q}{>{\raggedright\arraybackslash\unskip}X}
\newcolumntype{W}{>{\raggedleft\arraybackslash\unskip}X}
\newcolumntype{L}{>{\raggedright\arraybackslash\unskip}p}
\newcolumntype{P}{>{\RaggedRight\arraybackslash\unskip}p}
\newcolumntype{R}{>{\raggedleft\arraybackslash\unskip}p}
\newcolumntype{C}{>{\centering\arraybackslash\unskip}X}
\newcolumntype{Z}{>{\centering\arraybackslash\unskip}p}
\newcolumntype{e}{!{\extracolsep{\fill}}}
\def\topfraction{0.9}
\def\textfraction{0.1}
\def\bottomfraction{0.8}
\def\totalnumber{8}
\def\topnumber{8}
\def\bottomnumber{8}
\def\floatpagefraction{.95}
\newbox \tp@subfltbox
\newcount\tp@subflts          \tp@subflts=\z@\relax
\newdimen\tp@subflt@maxheight \tp@subflt@maxheight=\z@\relax
\newdimen\tp@subflt@sep       \tp@subflt@sep=\fboxsep\relax
\newdimen\tp@subflt@width     \tp@subflt@width=\textwidth\relax
\def\tp@provide@setting#1#2{%
  \expandafter\def\csname @#1@internal@\endcsname{#2}%
  \expandafter\def\csname #1\endcsname{\@ifnextchar[{\csname @#1\endcsname}{\csname @#1\endcsname[]}}%]
  \expandafter\def\csname @#1\endcsname[##1]##2{%
    \edef\tp@opt@arg{##1}%
    \ifx\tp@opt@arg\@empty
      \ltx@LocalExpandAfter\gdef\csname @#1@internal@\endcsname{##2}%
    \else
      \ltx@LocalExpandAfter\gdef\csname @#1@internal@##1\endcsname{##2}%
    \fi
  }%
}
\def\tp@provide@switch#1{%
  \expandafter\let\csname @#1@internal@\endcsname\relax%
  \expandafter\def\csname #1\endcsname{\@ifnextchar[{\csname @#1\endcsname}{\csname @#1\endcsname[]}}%]
  \expandafter\def\csname @#1\endcsname[##1]{%
    \edef\tp@opt@arg{##1}%
    \ifx\tp@opt@arg\@empty
      \ltx@LocalExpandAfter\global\expandafter\let\csname @#1@internal@\endcsname\@empty%
    \else
      \ltx@LocalExpandAfter\global\expandafter\let\csname @#1@internal@##1\endcsname\@empty%
    \fi
  }%
}
\def\tp@use@setting#1{%
  \expandafter\ifx\csname @#1@internal@\tp@captype\endcsname\relax
    \csname @#1@internal@\endcsname
  \else
    \csname @#1@internal@\tp@captype\endcsname
  \fi}
\tp@provide@setting{tpCaptionLabelSep}{}
\tp@provide@setting{tpCaptionLabelFont}{}
\tp@provide@setting{tpCaptionSourceSep}{}
\tp@provide@setting{tpCaptionSourceFont}{}
\tp@provide@setting{tpCaptionLegendSep}{}
\tp@provide@setting{tpCaptionLegendFont}{}
\tp@provide@setting{tpCaptionFormat}{}
\tp@provide@setting{tpCaptionFont}{}
\tp@provide@setting{tpCaptionTopSkip}{\z@}
\tp@provide@setting{tpCaptionBelowSkip}{\z@}
\tp@provide@setting{tpCaptionOrderTop}{}
\tp@provide@setting{tpCaptionOrderBelow}{}
\tpCaptionOrderTop[figure]{}
\tpCaptionOrderBelow[figure]{label,caption,source,legend}
\tpCaptionOrderTop[table]{label,caption,source}
\tpCaptionOrderBelow[table]{legend}
 %\tp@provide@setting{tpCaptionSep}{\z@}
\tp@provide@setting{tpAboveFloatSkip}{\@fptop}
\tp@provide@setting{tpBelowFloatSkip}{\@fpbot}
\tp@provide@setting{tpSubFloatSep}{\tp@subflt@sep}
\def\tp@reset@subflts{%
  \global\tp@subflts=\z@
  \global\tp@subflt@maxheight=\z@\relax
}
\newenvironment{tpFigure}[1][]{\tp@float[#1]{figure}{lof}}{\endtp@float}
\newenvironment{tpFigure*}[1][]{\tp@float[#1]{figure}{lof}}{\endtp@dblfloat}
\newenvironment{tpTable}[1][]{\tp@float[#1]{table}{lot}}{\endtp@float}
\newenvironment{tpTable*}[1][]{\tp@float[#1]{table}{lot}}{\endtp@dblfloat}

\let\ltx@label\label
\@ifpackageloaded{htmltabs}{\global\let\tp@uses@htmltabs\relax}{}%

\def\tp@float[#1]#2#3{%
  \savenotes
  \begingroup
    \tp@reset@subflts
    \tp@reset@caption{0}%
    \def\tp@captype{#2}%
    \def\tp@caplisttype{#3}%
    \if!#1!\else
      \tp@parse@attributes#1\@nil%
      \expandafter\ifx\csname tp@attr@class\endcsname\relax\else
        \message{^^Jtranspect-floats.sty: Class of float \tp@captype\space is: `\tp@attr@class'.}%
        \cssUseClass{default}%
        \expandafter\cssUseClass\expandafter{\csname tp@attr@class\endcsname}%
      \fi
    \fi
    \expandafter\ifx\csname tp@attr@float-pos\endcsname\relax
      \let\tp@fps\@empty
    \else
      \expandafter\let\expandafter\tp@fps\csname tp@attr@float-pos\endcsname
    \fi
    \protected\def\tpFig##1{\ltx@LocalExpandAfter\protected\expandafter\gdef\csname tp@subflt@fig@\the\tp@subflts\endcsname{##1}}%
    \protected\def\tpCaption##1{\ltx@LocalExpandAfter\protected\expandafter\gdef\csname tp@subflt@cpt@\the\tp@subflts\endcsname{##1}}%
    \protected\def\tpLegend##1{\ltx@LocalExpandAfter\protected\expandafter\gdef\csname tp@subflt@lgd@\the\tp@subflts\endcsname{##1}}%
    \protected\def\tpSource##1{\ltx@LocalExpandAfter\protected\expandafter\gdef\csname tp@subflt@src@\the\tp@subflts\endcsname{##1}}%
    \protected\def\tpNumber##1{\ltx@LocalExpandAfter\protected\expandafter\gdef\csname tp@subflt@lbl@\the\tp@subflts\endcsname{##1}}%
    \protected\def\label##1{\ltx@LocalExpandAfter\protected\expandafter\gdef\csname tp@subflt@ref@\the\tp@subflts\endcsname{##1}}%
    \parindent\z@
    \ifx\tp@fps\@empty
      \expandafter\addvspace\expandafter{\tp@use@setting{tpAboveFloatSkip}}%
    \fi
    \ifx\tp@uses@htmltabs\relax\let\htOutputTable\relax\fi
  }

\def\endtp@float{%
  \ifx\tp@fps\@empty\else
    \def\@tempa{h}\ifx\tp@fps\@tempa\def\tp@fps{ht!}\fi
    \ifx\tp@do@dblfloat\relax
      \expandafter\@dblfloat\expandafter{\expandafter\tp@captype\expandafter}\expandafter[\tp@fps]%
    \else
      \expandafter\@float\expandafter{\expandafter\tp@captype\expandafter}\expandafter[\tp@fps]%
    \fi
  \fi
  \csname tp@\tp@captype @float\endcsname
  \ifx\tp@fps\@empty
    \expandafter\vskip\tp@use@setting{tpBelowFloatSkip}\relax%
  \else
    \ifx\tp@do@dblfloat\relax
      \end@dblfloat
      \global\let\tp@do@dblfloat\@undefined
    \else
      \end@float
    \fi
  \fi
  \endgroup
  \spewnotes}
\def\endtp@dblfloat{\let\tp@do@dblfloat\relax\endtp@float}%
\def\tp@table@float{%
  \expandafter\ifx\csname tp@subflt@cpt@0\endcsname\relax
  \else
    \tp@make@caption{0}{Top}\nobreak\par%
    \vskip\tp@use@setting{tpCaptionTopSkip}%
  \fi
  \ifx\htTableBox\@undefined
  \else
    \box\htTableBox
  \fi
  \nobreak\par
  \expandafter\ifx\csname tp@subflt@cpt@0\endcsname\relax\else
    \vskip\tp@use@setting{tpCaptionBelowSkip}%
    \tp@make@caption{0}{Below}\nobreak%
    \tp@add@list{0}%
  \fi}

\def\tp@add@list#1{%
  \expandafter\expandafter\expandafter\def\expandafter\expandafter\expandafter\tp@lo@cpt\expandafter\expandafter\expandafter{\csname tp@subflt@cpt@#1\endcsname}%
  \expandafter\expandafter\expandafter\def\expandafter\expandafter\expandafter\tp@lo@src\expandafter\expandafter\expandafter{\csname tp@subflt@src@#1\endcsname}%
  \expandafter\expandafter\expandafter\def\expandafter\expandafter\expandafter\tp@lo@lbl\expandafter\expandafter\expandafter{\csname tp@subflt@lbl@#1\endcsname}%
  \expandafter\expandafter\expandafter\def\expandafter\expandafter\expandafter\tp@lo@ref\expandafter\expandafter\expandafter{\csname tp@subflt@ref@#1\endcsname}%
  \expandafter\ifx\tp@lo@src\relax\def\tp@lo@src{}\fi
  \expandafter\ifx\tp@lo@cpt\relax\else
    \expandafter\ifx\tp@lo@lbl\relax
      \addcontentsline{\tp@caplisttype}{\tp@captype}{\tp@lo@cpt\tp@lo@src}%
    \else
      \tp@make@anchor%
      \addcontentsline{\tp@caplisttype}{\tp@captype}{\string\numberline{\tp@lo@lbl}\tp@lo@cpt\tp@lo@src}%
    \fi
    \tp@reset@caption{#1}%
  \fi}

\def\tp@make@anchor{%
  \expandafter\ifx\tp@lo@ref\relax\else
    \let\@currentlabel\tp@lo@lbl
    \expandafter\H@refstepcounter\expandafter{\tp@captype}%
    \expandafter\hyper@makecurrent\expandafter{\tp@captype}%
    \let\Hy@tempa\Hy@float@caption
    \expandafter\hyper@@anchor\expandafter{%
      \@currentHref
    }{\relax}%
    \expandafter\ltx@label\expandafter{\tp@lo@ref}%
  \fi}

\let\ltx@includegraphics\includegraphics
\def\tp@includesubgraphics{\@ifnextchar [\@tp@includesubgraphics{\@tp@includesubgraphics[]}}%]
\def\@tp@includesubgraphics[#1]#2{%
  \def\@igopts{#1,width=\hsize}%
  \expandafter\ltx@includegraphics\expandafter[\@igopts]{#2}%
}

\def\tp@figure@float{%
  \tp@subflt@width=\hsize\relax
  \vbox{%
    \expandafter\ifx\csname tp@subflt@cpt@0\endcsname\relax\else
      \tp@make@caption{0}{Top}%
      \nobreak\par
      \vskip\tp@use@setting{tpCaptionTopSkip}%
    \fi
    \bgroup
      \expandafter\tp@subflt@sep=\tp@use@setting{tpSubFloatSep}%
      \@tempdima=\z@\relax
      \ifnum\tp@subflts=\z@\relax
        \tp@usefloat0%
      \else
        \sh@iterate{\@tempcnta}{\@ne}{\tp@subflts}{%
          \edef\@tempa{\CalcRatio{\tp@subflt@maxheight}{\csname tp@subflt@height@\the\@tempcnta\endcsname}}%
          \ifnum\@tempcnta>\@ne
            \expandafter\global\expandafter\advance\expandafter\tp@subflt@width\expandafter-\tp@subflt@sep\relax%
          \fi
          \expandafter\@tempdimc\csname tp@subflt@width@\the\@tempcnta\endcsname\relax
          \@tempdimb=\@tempa\@tempdimc\relax
          \expandafter\edef\csname  tp@subflt@adj@width@\the\@tempcnta\endcsname{\the\@tempdimb}%
          \advance\@tempdima\@tempdimb
        }% /sh@iterate
        \@tempcnta\z@
        \sh@iterate{\@tempcnta}{\@ne}{\tp@subflts}{%
          \edef\@tempa{\CalcRatio{\csname tp@subflt@adj@width@\the\@tempcnta\endcsname}{\@tempdima}}%
          \expandafter\edef\csname tp@subflt@res@width@\the\@tempcnta\endcsname{\dimexpr\@tempa\tp@subflt@width\relax}%
          \expandafter\ifx\csname tp@subflt@cpt@\the\@tempcnta\endcsname\relax\else\let\tp@has@capt\relax\fi
        }%
        \ifx\tp@has@capt\relax\tp@create@mp{\tp@usecapt{\the\@tempcnta}}\\\fi%
        \tp@create@mp{\csname tp@subflt@fig@\the\@tempcnta\endcsname}%
        \ifx\tp@has@capt\relax \\\tp@create@mp{\tp@usecapb{\the\@tempcnta}}\\\fi%
      \fi
    \egroup
    \expandafter\ifx\csname tp@subflt@cpt@0\endcsname\relax\else
      \nobreak
      \vskip\tp@use@setting{tpCaptionBelowSkip}%
      \tp@make@caption{0}{Below}%
      \tp@add@list{0}%
    \fi
  }% /vbox
}
\def\tp@create@mp#1{%
  \sh@iterate{\@tempcnta}{\@ne}{\tp@subflts}{%
    \ifnum\@tempcnta>\@ne\relax\hskip\tp@subflt@sep\relax\fi
    \begin{minipage}[t][][t]{\the\csname tp@subflt@res@width@\the\@tempcnta\endcsname}%
      \let\includegraphics\tp@includesubgraphics
      #1\nobreak\par
    \end{minipage}%
  }}

\def\tp@usefloat#1{{%
    \tp@usecapt{#1}%
    \csname tp@subflt@fig@#1\endcsname\nobreak\par
    \tp@usecapb{#1}%
}}

\def\tp@usecapt#1{{%
    \parindent\z@
    \ifnum\tp@subflts=\z@\relax\else
      \expandafter\ifx\csname tp@subflt@cpt@#1\endcsname\relax\else
        \tp@make@caption{#1}{Top}\nobreak%
        \nobreak\par
        \vskip\tp@use@setting{tpCaptionTopSkip}%
      \fi
    \fi
}}

\def\tp@usecapb#1{{%
    \ifnum\tp@subflts=\z@\relax\else
      \expandafter\ifx\csname tp@subflt@cpt@#1\endcsname\relax\else
        \nobreak
        \vskip\tp@use@setting{tpCaptionBelowSkip}%
        \tp@make@caption{#1}{Below}\nobreak%
        \tp@add@list{#1}%
      \fi
    \fi
}}

\def\tp@use@label#1{%
  \expandafter\ifx\csname tp@subflt@lbl@#1\endcsname\relax\else
    \bgroup
      \expandonce{\tp@use@setting{tpCaptionLabelFont}}%
      \csname tp@subflt@lbl@#1\endcsname%
    \egroup
    \tp@use@setting{tpCaptionLabelSep}%
  \fi
}
\def\tp@use@legend#1{%
  \expandafter\ifx\csname tp@subflt@lgd@#1\endcsname\relax\else
    \tp@use@setting{tpCaptionLegendSep}%
    \bgroup
      \expandonce{\tp@use@setting{tpCaptionLegendFont}}%
      \expandonce{\csname tp@subflt@lgd@#1\endcsname}%
    \egroup
  \fi
}
\def\tp@use@source#1{%
  \expandafter\ifx\csname tp@subflt@src@#1\endcsname\relax\else
    \tp@use@setting{tpCaptionSourceSep}%
    \bgroup
      \expandonce{\tp@use@setting{tpCaptionSourceFont}}%
      \expandonce{\csname tp@subflt@src@#1\endcsname}%
    \egroup
  \fi
}
\def\tp@use@caption#1{%
  \bgroup
    \expandonce{\tp@use@setting{tpCaptionFont}}%
    \expandonce{\csname tp@subflt@cpt@#1\endcsname}%
  \egroup}

\def\tp@traverse@cap@order #1,#2,\@nil#3{%
  \if!#1!\else
    \expandafter\ifx\csname tp@use@#1\endcsname\relax\else%
      \csname tp@use@#1\endcsname{#3}%
    \fi
    \if!#2!\else
      \tp@traverse@cap@order#2,\@nil{#3}%
    \fi
  \fi
}
\def\tp@caption@order#1#2{%
  \edef\@tp@cap@odr{\tp@use@setting{tpCaptionOrder#2}}%
  \expandafter\tp@traverse@cap@order\@tp@cap@odr,,\@nil{#1}%
}

\def\tp@make@caption#1#2{%
  \bgroup%
    \expandonce{\tp@use@setting{tpCaptionFormat}}%
    \tp@caption@order{#1}{#2}%
    \nobreak\par
  \egroup
}
\def\tp@reset@caption#1{%
  \ltx@LocalExpandAfter\global\expandafter\let\csname tp@subflt@fig@#1\endcsname\relax%
  \ltx@LocalExpandAfter\global\expandafter\let\csname tp@subflt@cpt@#1\endcsname\relax%
  \ltx@LocalExpandAfter\global\expandafter\let\csname tp@subflt@src@#1\endcsname\relax%
  \ltx@LocalExpandAfter\global\expandafter\let\csname tp@subflt@lbl@#1\endcsname\relax%
  \ltx@LocalExpandAfter\global\expandafter\let\csname tp@subflt@lgd@#1\endcsname\relax%
  \ltx@LocalExpandAfter\global\expandafter\let\csname tp@subflt@ref@#1\endcsname\relax%
  }
\def\tpSubFloat{%
  \global\advance\tp@subflts\@ne
}
\def\endtpSubFloat{%
  \setbox\tp@subfltbox\hbox{\csname tp@subflt@fig@\the\tp@subflts\endcsname}%
  \expandafter\xdef\csname tp@subflt@width@\the\tp@subflts\endcsname{\the\wd\tp@subfltbox}%
  \expandafter\xdef\csname tp@subflt@height@\the\tp@subflts\endcsname{\the\ht\tp@subfltbox}%
  \expandafter\xdef\csname tp@subflt@depth@\the\tp@subflts\endcsname{\the\dp\tp@subfltbox}%
  \expandafter\ifdim\csname tp@subflt@height@\the\tp@subflts\endcsname>\tp@subflt@maxheight\relax
    \expandafter\global\expandafter\tp@subflt@maxheight=\csname tp@subflt@height@\the\tp@subflts\endcsname\relax
  \fi}

\def\tablefont{\small}
\def\arraystretch{1.3}
\def\@tabular{%
  \leavevmode
  \hbox \bgroup\tablefont $\col@sep\tabcolsep \let\d@llarbegin\begingroup%$
                                    \let\d@llarend\endgroup
  \ifx\ST@tableformat\@undefined\gdef\@tablefont{\tablefont}\fi
  \@tabarray}
\let\@classzold\@classz
\def\@classz{%
   \expandafter\ifx\d@llarbegin\begingroup
     \toks \count@ =
     \expandafter{\expandafter\@tablefont\the\toks\count@}%
   \fi
   \@classzold}
\def\endtabular{%
  \endarray
  $\egroup}%$
\expandafter\let\csname endtabular*\endcsname=\endtabular
\def\CSSDeclareClass{\@ifnextchar [{\css@set@class}{\css@set@class[]}}%]

\gdef\css@@class@default{}
\gdef\css@figure@class@default{}
\gdef\css@table@class@default{}

\def\css@set@class[#1]#2#3{%
  \def\@argii{#2}\ifx\@argi\@empty\def\@argii{default}\fi%
  \expandafter\def\csname css@#1@class@\@argii\endcsname{%
    #3%
  }%
}

\def\cssUseClass#1{%
  \expandafter\ifx\csname css@\tp@captype @class@#1\endcsname\relax
    \expandafter\ifx\csname css@@class@#1\endcsname\relax
      \PackageError{transpect-flaots.sty}{Class `#1' not defined!}{Please declare the class `#1'!}%
    \fi
  \fi
  %\csname css@@class@#1\endcsname
  %\csname css@\tp@captype @class@#1\endcsname
}


\endinput
%%
%% End of file `transpect-floats.sty'.
