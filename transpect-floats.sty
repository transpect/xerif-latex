%%
%% This is file `transpect-floats.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% transpect.dtx  (with options: `floats')
%% 
%% IMPORTANT NOTICE:
%% 
%% For the copyright see the source file.
%% 
%% Any modified versions of this file must be renamed
%% with new filenames distinct from transpect-floats.sty.
%% 
%% For distribution of the original source see the terms
%% for copying and modification in the file transpect.dtx.
%% 
%% This generated file may be distributed as long as the
%% original source files, as listed above, are part of the
%% same distribution. (The sources need not necessarily be
%% in the same archive or directory.)
\def\fileversion{0.90}%
\def\filedate{2020-04-22}%
%%
%% module for le-tex transpect.cls that extends floating objects.
%%
%% Maintainer: p.schulz@le-tex.de
%%
%% lualatex  -  texlive > 2019
%%
\NeedsTeXFormat{LaTeX2e}[2019/01/01]
\ProvidesPackage{transpect-floats}
    [2020/22/04 0.90 le-tex transpect floats module]
\usepackage{tabularx}
\usepackage{multirow}
\usepackage{caption}
\newcolumntype{Q}{>{\raggedright\arraybackslash\unskip}X}
\newcolumntype{W}{>{\raggedleft\arraybackslash\unskip}X}
\newcolumntype{L}{>{\raggedright\arraybackslash\unskip}p}
\newcolumntype{P}{>{\RaggedRight\arraybackslash\unskip}p}
\newcolumntype{R}{>{\raggedleft\arraybackslash\unskip}p}
\newcolumntype{C}{>{\centering\arraybackslash\unskip}X}
\newcolumntype{Z}{>{\centering\arraybackslash\unskip}p}
\newcolumntype{e}{!{\extracolsep{\fill}}}

\newbox \tp@subfltbox
\newcount\tp@subflts          \tp@subflts=\z@\relax
\newdimen\tp@subflt@maxheight \tp@subflt@maxheight=\z@\relax
\newdimen\tp@subflt@sep       \tp@subflt@sep=\fboxsep\relax
\newdimen\tp@subflt@hsize     \tp@subflt@hsize=\textwidth\relax

\def\tp@provide@setting#1#2{%
  \expandafter\def\csname #1\endcsname{\@ifnextchar[{\csname @#1\endcsname}{\csname @#1\endcsname[]}}%]
  \expandafter\def\csname @#1\endcsname[##1]##2{\ltx@LocalExpandAfter\gdef\csname #2\if!##1!\else##1\fi\endcsname{##2}}%
}

\tp@provide@setting{tpCaptionLabelSep}{tp@cap@labelsep@}
\tp@provide@setting{tpCaptionSourceSep}{tp@cap@sourcesep@}
\tp@provide@setting{tpCaptionSep}{tp@cap@sep@}
\tp@provide@setting{tpAboveFloatSkip}{tp@above@flt@skip@}
\tp@provide@setting{tpBelowFloatSkip}{tp@below@flt@skip@}
\tp@provide@setting{tpSubFloatSep}{tp@subflt@sep}

\def\tp@reset@subflts{%
  \global\tp@subflts=\z@
  \global\tp@subflt@maxheight=\z@\relax
}

\def\tpFigure{\@ifnextchar[{\tp@Figure}{\tp@Figure[!]}}%]
\def\tp@Figure[#1]{\tp@float[#1]{figure}}
\def\endtpFigure{\endtp@float}

\def\tp@float[#1]#2{%
  \begingroup
    \tp@reset@subflts
    \tp@reset@caption{0}%
    \def\@captype{#2}%
    \def\Fig##1{\ltx@LocalExpandAfter\gdef\csname tp@subflt@fig@\the\tp@subflts\endcsname{##1}}%
    \def\Caption##1{\ltx@LocalExpandAfter\gdef\csname tp@subflt@cpt@\the\tp@subflts\endcsname{##1}}%
    \def\Source##1{\ltx@LocalExpandAfter\gdef\csname tp@subflt@src@\the\tp@subflts\endcsname{##1}}%
    \def\Label##1{\ltx@LocalExpandAfter\gdef\csname tp@subflt@lbl@\the\tp@subflts\endcsname{##1}}%
    \parindent\z@
    \ifx\csname tp@above@flt@skip@\@captype\endcsname\relax\else
      \expandafter\addvspace\expandafter{\csname tp@above@flt@skip@\@captype\endcsname}%
    \fi
  }

  \def\endtp@float{%
    \tp@subflt@hsize=\hsize\relax
    \vbox{%
      \bgroup
        \@tempdima=\z@\relax
        \ifnum\tp@subflts=\z@\relax
          \tp@usefloat0%
        \else
          \sh@iterate{\@tempcnta}{\@ne}{\tp@subflts}{%
            \edef\@tempa{\CalcRatio{\tp@subflt@maxheight}{\csname tp@subflt@height@\the\@tempcnta\endcsname}}%
            \ifnum\@tempcnta>\@ne\global\advance\tp@subflt@hsize-\tp@subflt@sep\relax\fi
            \expandafter\@tempdimc\csname tp@subflt@width@\the\@tempcnta\endcsname\relax
            \@tempdimb=\@tempa\@tempdimc\relax
            \expandafter\edef\csname  tp@subflt@adj@width@\the\@tempcnta\endcsname{\the\@tempdimb}%
            \advance\@tempdima\@tempdimb
          }%
          \@tempcnta\z@
%% 2nd iteration: Calculate width ratio of all adjusted subfigures against total width of all figures plus separators and output:
          \sh@iterate{\@tempcnta}{\@ne}{\tp@subflts}{%
            \edef\@tempa{\CalcRatio{\csname tp@subflt@adj@width@\the\@tempcnta\endcsname}{\@tempdima}}%
            \@tempdimb\@tempa\tp@subflt@hsize\relax
            \ifnum\@tempcnta>\@ne\hskip\tp@subflt@sep\fi
            \begin{minipage}[t]{\@tempdimb}%
              \captionsetup{margin=\z@}%
              \tp@usefloat{\the\@tempcnta}%
            \end{minipage}%
          }%
        \fi
      \egroup
      \expandafter\ifx\csname tp@subflt@cpt@0\endcsname\relax\else
        \tp@make@caption{0}%
      \fi
    }
    \ifx\csname tp@below@flt@skip@\@captype\endcsname\relax\else
      \expandafter\vskip\csname tp@below@flt@skip@\@captype\endcsname
    \fi
  \endgroup
}

\def\tp@usefloat#1{{%
    \parindent\z@
    \csname tp@subflt@fig@#1\endcsname\nobreak\par
    \expandafter\ifx\csname tp@cap@sep@\@captype\endcsname\relax\else
      \expandafter\vskip\csname tp@cap@sep@\@captype\endcsname
    \fi
    \expandafter\ifx\csname tp@subflt@cpt@#1\endcsname\relax
    \else
      \tp@make@caption{#1}%
    \fi
}}

\def\tp@make@caption#1{%
  {\edef\tp@cap{%
     \csname tp@subflt@lbl@#1\endcsname\csname tp@cap@labelsep@\@captype\endcsname%
     \csname tp@subflt@cpt@#1\endcsname\csname tp@cap@sourcesep@\@captype\endcsname
     \csname tp@subflt@src@#1\endcsname}%
   \expandafter\caption\expandafter*\expandafter{\tp@cap}%
   \addcontentsline{lof}{figure}{\string\numberline{\csname tp@subflt@lbl@#1\endcsname}\csname tp@subflt@cpt@#1\endcsname\csname tp@subflt@src@#1\endcsname}%
   \tp@reset@caption{#1}%
 }}

\def\tp@reset@caption#1{
  \ltx@LocalExpandAfter\global\expandafter\let\csname tp@subflt@fig@#1\endcsname\relax%
  \ltx@LocalExpandAfter\global\expandafter\let\csname tp@subflt@cpt@#1\endcsname\relax%
  \ltx@LocalExpandAfter\global\expandafter\let\csname tp@subflt@src@#1\endcsname\relax%
  \ltx@LocalExpandAfter\global\expandafter\let\csname tp@subflt@lbl@#1\endcsname\relax%
  }

\def\tpSubFloat{%
  \global\advance\tp@subflts\@ne
}

\def\endtpSubFloat{%
  \setbox\tp@subfltbox\hbox{\csname tp@subflt@fig@\the\tp@subflts\endcsname}%
  \expandafter\xdef\csname tp@subflt@width@\the\tp@subflts\endcsname{\the\wd\tp@subfltbox}%
  \expandafter\xdef\csname tp@subflt@height@\the\tp@subflts\endcsname{\the\ht\tp@subfltbox}%
  \expandafter\ifdim\csname tp@subflt@height@\the\tp@subflts\endcsname>\tp@subflt@maxheight\relax
    \expandafter\global\expandafter\tp@subflt@maxheight=\csname tp@subflt@height@\the\tp@subflts\endcsname\relax
  \fi}

%%%%%%%%%%
%%%%%%%%%%














\def\tablefont{\small}
\def\arraystretch{1.3}
\def\@tabular{%
  \leavevmode
  \hbox \bgroup\tablefont $\col@sep\tabcolsep \let\d@llarbegin\begingroup%$
                                    \let\d@llarend\endgroup
  \ifx\ST@tableformat\@undefined\gdef\@tablefont{\tablefont}\fi
  \@tabarray}
\let\@classzold\@classz
\def\@classz{%
   \expandafter\ifx\d@llarbegin\begingroup
     \toks \count@ =
     \expandafter{\expandafter\@tablefont\the\toks\count@}%
   \fi
   \@classzold}
\def\endtabular{%
  \endarray
  $\egroup}%$
\expandafter\let\csname endtabular*\endcsname=\endtabular

\endinput
%%
%% End of file `transpect-floats.sty'.
