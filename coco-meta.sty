%%
%% This is file `coco-meta.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% cocotex.dtx  (with options: `meta')
%% 
%% IMPORTANT NOTICE:
%% 
%% For the copyright see the source file.
%% 
%% Any modified versions of this file must be renamed
%% with new filenames distinct from coco-meta.sty.
%% 
%% For distribution of the original source see the terms
%% for copying and modification in the file cocotex.dtx.
%% 
%% This generated file may be distributed as long as the
%% original source files, as listed above, are part of the
%% same distribution. (The sources need not necessarily be
%% in the same archive or directory.)
\def\fileversion{0.3.0}%
\def\filedate{2023-08-03}%
%%
%% module for CoCoTeX that provides handling of a document's meta data.
%%
%% Maintainer: p.schulz@le-tex.de
%%
%% lualatex  -  texlive > 2019
%%
\NeedsTeXFormat{LaTeX2e}[2018/12/01]
\ProvidesPackage{coco-meta}
    [\filedate \fileversion CoCoTeX meta module]
\RequirePackage{coco-common}
\tpDeclareContainer{Meta}{%
  \tpDeclareType{Components}{%
    \tpDeclareRole[author]{Author}%
    \tp@declare@meta@comp
    \tp@declare@meta@affils
  }%
  \tpDeclareType{Properties}{%
    \tp@Meta@default
  }%
}
\def\tp@meta@generic@comp{%
  \tpDeclareComp{GenericMetaBlock}{\expandafter\global}{}%
  \tpDeclareComponentGroup{tpGenericMeta}{%
    \tpDeclareCountedComp{Heading}%
    \tpDeclareCountedComp{Content}%
  }}
\def\tp@meta@generic@eval{{%
  \def\tp@cur@cont{titlepage}%
  \tpComposeCollection{tpGenericMeta}{generic-meta-format}{GenericMetaBlock}
}}
\def\tpDeclareRole{\tp@opt@second\tp@declare@role}%
\def\tp@declare@role[#1]#2{%
  \tpDeclareComponentGroup{tp#2}{%
    \tpDeclareCountedComp{FullName}%
    \tpDeclareCountedComp{CiteName}%
    \tpDeclareCountedComp{ShortCiteName}%
    \tpDeclareCountedComp{Initial}%
    \tpDeclareCountedComp{LastName}%
    \tpDeclareCountedComp{FirstName}%
    \tpDeclareCountedComp{MidName}%
    \tpDeclareCountedComp{PersonPrefix}%
    \tpDeclareCountedComp{ORCID}%
    \tpDeclareCountedComp{Affil}%
    \tpDeclareCountedComp{Email}%
  }%
  \tpGroupHandler{tp#2}{%
    \tpIfComp{FullName}{}{\tpFullName{\tpUseProperty{name-format}}}%
    \tpIfComp{Initial}{}{\tpInitial{\tpUseProperty{initials-format}}}%
    \tpIfComp{CiteName}{}{\tpCiteName{\tpUseProperty{cite-name-format}}}%
    \tpIfComp{ShortCiteName}{}{\tpShortCiteName{\tpUseProperty{short-cite-name-format}}}%
  }%
  \tpDeclareRoleBlock{#2}{NameList}{#1-list-format}%
  \tpDeclareRoleBlock{#2}{CitationList}{#1-citation-format}%
  \tpDeclareRoleBlock{#2}{ShortCitationList}{#1-short-citation-format}%
}
\def\tpAddToRole#1#2{\csgappto{tp#1}{#2}}
\def\tpDeclareRoleBlock#1#2#3{%
  \tpDeclareComp{#1#2}{\expandafter\global}{}%
  \csgdef{tp@meta@role@#1@#2}{#3}}
\def\tp@meta@role@eval#1{{%
    \@tp@meta@role@eval{#1}{NameList}%
    \@tp@meta@role@eval{#1}{CitationList}%
    \@tp@meta@role@eval{#1}{ShortCitationList}%
  }}
\def\@tp@meta@role@eval#1#2{%
  \tpIfComp{#1#2}{}{%
    \ifcsdef{tp#1Cnt}
      {\expandafter\ifnum\csname tp#1Cnt\endcsname>\z@
          \tp@eval@role@attrs{#1}%
          \tpApplyCollection{tp#1}{\csname tp@meta@role@#1@#2\endcsname}{#1#2}%
        \fi
      }{}}}
\def\tp@eval@role@attrs#1{%
    \tp@iterate{\@tempcnta}{\@ne}{\csname tp#1Cnt\endcsname}{%
      \ifcsdef{tp@meta@#1-\the\@tempcnta @attrs\endcsname}{%
        \tpParseAttributes{#1-\the\@tempcnta }{\csname tp@meta@#1-\the\@tempcnta @attrs\endcsname}%
      }{}}}
\def\tpDeclareLabeledComp{\tp@opt@empty\tp@declare@labeled@comp}
\def\tp@declare@labeled@comp[#1]#2#3{%
  \tpDeclareComp{#2}{\expandafter\global}{}%
  \tpDeclareComp{#2Label}{\expandafter\global}{}%
  \csxdef{property-infix-\tp@cur@cont-#2}{#3}%
  \if!#1!\else\expandafter\long\expandafter\def\csname tp@\tp@cur@cont @#2Label\endcsname{#1}\fi
}
\def\tpUseLabeledComp#1{%
  \tpIfComp{#1}{%
    \letcs\tp@infix{property-infix-\tp@cur@cont-#1}%
    \tpIfProp{meta-before-\tp@infix}{\tpUseProperty{meta-before-\tp@infix}}{\tpMetaBeforeLabeledComp}%
    \bgroup
      \tpIfProp{meta-\tp@infix-face}{\tpUseProperty{meta-\tp@infix-face}}{\tpMetaLabeledCompFace}%
      \tpIfComp{#1Label}{%
        \bgroup
          \tpIfProp{meta-\tp@infix-label-face}{\tpUseProperty{meta-\tp@infix-label-face}}{\tpMetaLabeledCompLabelFace}%
          \tpUseComp{#1Label}%
          \tpIfProp{meta-\tp@infix-sep}{\tpUseProperty{meta-\tp@infix-sep}}{\tpMetaLabeledCompLabelSep}%
        \egroup
      }{}%
      \tpUseComp{#1}%
    \egroup
    \tpIfProp{meta-after-\tp@infix}{\tpUseProperty{meta-after-\tp@infix}}{\tpMetaAfterLabeledComp}%
  }{}}
\def\tpMetaBeforeLabeledComp{}
\def\tpMetaAfterLabeledComp{\par}
\def\tpMetaLabeledCompFace{}
\def\tpMetaLabeledCompLabelFace{\bfseries}
\def\tpMetaLabeledCompLabelSep{:\enskip}
\def\tp@declare@meta@comp{%
    \tpDeclareComp{Copyright}{\expandafter\global}{}% Copyright text
    \tpDeclareComp{DOI}{\expandafter\global}{}%         DOI
}%
\def\tp@extended@meta@macros{%
  \tpDeclareLabeledComp[Abstract]{Abstract}{abstract}%
  \tpDeclareLabeledComp[Keywords]{Keywords}{keyword}%
  \tpDeclareLabeledComp{DOI}{doi}%
  \tpDeclareLabeledComp{TitleEn}{title-en}%
}
\def\tp@declare@meta@affils{%
  \tpDeclareComp{AffilBlock}{\expandafter\global}{}%
  \tpDeclareComponentGroup{tpAffil}{%
    \tpDeclareCountedComp{Affiliation}%
    \tpDeclareCountedComp{Address}%
    \tpDeclareCountedComp{Institute}%
    \tpDeclareCountedComp{Country}%
    \tpDeclareCountedComp{Department}%
    \tpDeclareCountedComp{AffilID}%
  }%
  \tpGroupHandler{tpAffil}{%
    \tpIfComp{AffilID}{}{\expandafter\tpAffilID\expandafter{\tpAffilCnt}}%
    \tpIfComp{Affiliation}{}{\tpAffiliation{\tpUseProperty{affiliation-format}}}%
  }%
}
\tpAddToDefault{Meta}{%
  \tpSetProperty{initials-format}{%
    \expandafter\ifx\csname tp@\tp@cur@cont @\tp@cnt@grp-FirstName-\the\tpCurCount\endcsname\long@empty\else
      \expandafter\ifx\csname tp@\tp@cur@cont @\tp@cnt@grp-FirstName-\the\tpCurCount\endcsname\relax\else
        \expandafter\expandafter\expandafter\@car\csname tp@\tp@cur@cont @\tp@cnt@grp-FirstName-\the\tpCurCount\endcsname\relax\@nil\tpUseProperty{initials-period}
      \expandafter\ifx\csname tp@\tp@cur@cont @\tp@cnt@grp-MidName-\the\tpCurCount\endcsname\long@empty\else
        \expandafter\ifx\csname tp@\tp@cur@cont @\tp@cnt@grp-MidName-\the\tpCurCount\endcsname\relax\else
          \tpUseProperty{initials-sep}%
          \expandafter\expandafter\expandafter\@car\csname tp@\tp@cur@cont @\tp@cnt@grp-MidName-\the\tpCurCount\endcsname\relax\@nil\tpUseProperty{initials-period}%
        \fi\fi
    \fi\fi
  }
  \tpSetProperty{initials-sep}{~}
  \tpSetProperty{initials-period}{.}
  \tpSetProperty{name-format}{\tpUseComp{FirstName}\space\tpUseComp{LastName}}%
  \tpSetProperty{cite-name-format}{\tpUseComp{LastName}}%
  \tpSetProperty{short-cite-name-format}{\tpUseComp{LastName},~\tpUseComp{Initial}}%
  \tpSetProperty{name-list-format}{\tpUseComp{FullName}\ifnum\tpCurCount<\tpTotalCount\tpUseProperty{counted-name-sep}\fi}%
  \tpSetProperty{name-citation-format}{\tpUseComp{CiteName}}%
  \tpSetProperty{name-short-citation-format}{\tpUseComp{ShortCiteName}}%
  % Aliasses
  \tpPropertyLet{author-format}{name-format}% Override for single author names
  \tpPropertyLet{author-list-format}            {name-list-format}% Override for single author names
  \tpPropertyLet{author-citation-format}        {name-citation-format}% Override for single author names
  \tpPropertyLet{author-short-citation-format}  {name-short-citation-format}% Override for single author names
  %
  \tpSetProperty{counted-name-sep}{,\space}%
  \tpSetProperty{name-and}{\space and\space}%
  \tpSetProperty{name-etal}{\space et~al.}%
  \tpSetProperty{name-sep}{,\space}%
  \tpSetProperty{corresp-mark}{*}%
  % Affiliation Properties
  \tpSetProperty{affiliation-format}{% Format of the  affiliation block
    \tpIfComp{Institute}{\tpUseComp{Institute}}{}%
    \tpIfComp{Department}{, \tpUseComp{Department}}{}%
    \tpIfComp{Address}{, \tpUseComp{Address}}{}%
    \tpUseProperty{affil-sep}%
  }%
  \tpSetProperty{affil-sep}{\par}
  \tpSetProperty{affil-block-format}{\textsuperscript{\tpUseComp{AffilID}}\tpUseComp{Affiliation}}
  \tpSetProperty{affil-block-face}{\small\normalfont}
}
\endinput
%%
%% End of file `coco-meta.sty'.
