%%
%% This is file `coco-common.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% cocotex.dtx  (with options: `common')
%% 
%% IMPORTANT NOTICE:
%% 
%% For the copyright see the source file.
%% 
%% Any modified versions of this file must be renamed
%% with new filenames distinct from coco-common.sty.
%% 
%% For distribution of the original source see the terms
%% for copying and modification in the file cocotex.dtx.
%% 
%% This generated file may be distributed as long as the
%% original source files, as listed above, are part of the
%% same distribution. (The sources need not necessarily be
%% in the same archive or directory.)
%%
%% module for CoCoTeX that provides some commonly used base macros.
%%
%% Maintainer: p.schulz@le-tex.de
%%
\NeedsTeXFormat{LaTeX2e}[2023/11/01]
\ProvidesPackage{coco-common}
    [2024/12/19 v0.5.0 CoCoTeX common module]
\SetDefaultHookLabel{cc}
\def\cc@str@cmyk{cmyk}
\def\cc@str@rgb{rgb}
\def\cc@str@gray{gray}
\def\cc@str@natural{natural}
\let\cc@color@enc\cc@str@cmyk
\ExplSyntaxOn
\keys_define:nn { cocotex/common }
{
  color-enc .choice:,
  color-enc / srgb .code:n = { \global\let\cc@color@enc\cc@str@rgb },
  color-enc / rgb  .code:n = { \global\let\cc@color@enc\cc@str@rgb },
  color-enc / gray .code:n = { \global\let\cc@color@enc\cc@str@gray },
  color-enc / grey .code:n = { \global\let\cc@color@enc\cc@str@gray },
  color-enc / cmy  .code:n = { \global\let\cc@color@enc\cc@str@cmyk },
  color-enc / cmyk .code:n = { \global\let\cc@color@enc\cc@str@cmyk },
  color-enc / natural .code:n = { \global\let\cc@color@enc\cc@str@natural },
  color-enc / none .code:n = { \global\let\cc@color@enc\relax },
  color-enc .initial:n = cmyk
}
\newif\if@cc@silent  \@cc@silentfalse
\keys_define:nn { cocotex/common }
{
  silent .code:n = { \global\@cc@silenttrue }%
}
\ProcessKeyOptions[cocotex/common]
\ifx\cc@color@enc\relax\else
  \tl_gset:Nn \l_color_fixed_model_tl {\cc@color@enc}%
  \PassOptionsToPackage{\cc@color@enc}{xcolor}%
\fi%
\ExplSyntaxOff
\def\cc@if@preamble{\ifx\@nodocument\relax\expandafter\@secondoftwo\else\expandafter\@firstoftwo\fi}
\let\ccIfPreamble\cc@if@preamble
\IfFileExists{coco-xerif.sty}{\RequirePackage{coco-xerif}}{}
\RequirePackage{coco-kernel}
\RequirePackage{xcolor}
\RequirePackage{graphicx}
\if@cc@silent\let\Gin@log\@gobble\fi
\DeclareGraphicsRule{.EPS}{eps}{.EPS}{}
\def\cc@str@default{default}
\def\cc@str@table{table}
\def\cc@str@figure{figure}
\def\cc@str@top{top}
\def\cc@str@bottom{bottom}
\newbox\cc@tempboxa
\newbox\cc@tempboxb
\newskip\cc@tempskipa
\def\cc@topstrut{\vrule\@width\z@\@height\topskip\@depth\dimexpr\baselineskip-\topskip\relax}
\def\cc@afterbox{%
  \everypar{%
    \if@nobreak
      \@nobreakfalse
      \clubpenalty \@M
      \if@afterindent \else
        {\setbox\z@\lastbox}%
        \everypar{}%
      \fi
    \else
      \clubpenalty \@clubpenalty
      {\setbox\z@\lastbox}%
      \everypar{}%
    \fi}}
\ExplSyntaxOn
\cs_new:Npn\ccSanitizeStr #1 #2
  {
    \edef #1 { \text_purify:n { #2 } }
  }
\ExplSyntaxOff
\let\hack\@firstofone
\let\hackfor\@gobble
\let\Hack\@firstofone
\let\Hackfor\@gobble
\long\def\@gobbleopt{\@ifnextchar[\@@gobbleopt{\@@gobbleopt[]}}%]
\long\def\@@gobbleopt[#1]#2{}%
\def\ccGobble{%
  \renewcommand\footnote[2][\the\c@footnote]{\def\@thefnmark{##1}\@makefnmark}%
  \renewcommand\index[2][]{}%
  \renewcommand\marginpar[2][]{}%
  \renewcommand\glossary[2][]{}%
  \let\hypertarget\@gobbletwo
  \let\label\@gobble
  \@cc@is@finalfalse
}%
\def\CalcRatio#1#2{\strip@pt\dimexpr\number\numexpr\number\dimexpr#1\relax*65536/\number\dimexpr#2\relax\relax sp}
\def\CalcModulo#1#2{\number\numexpr#1+#2-((#1+#2/2)/#2)*#2\relax}
\def\@xminusvskip{%
  \ifdim\lastskip<\@tempskipb
  \else
    \ifdim\lastskip<\z@
    \else
      \ifdim\@tempskipb<\z@
        \advance\@tempskipb\lastskip
      \fi
      \vskip-\lastskip
      \vskip \@tempskipb
    \fi
  \fi}
\def\minusvspace#1{%
  \ifvmode
     \if@minipage\else
       \ifdim \lastskip =\z@
         \ifx\@vspace@calcify\@undefined
           \vskip #1\relax
         \else
           \@vspace@calcify{#1}%
         \fi
       \else
       \setlength\@tempskipb{#1}%
         \@xminusvskip
       \fi
     \fi
  \else
    \@noitemerr
  \fi}
\def\the@cc@thispage{}%
\newcount\cc@abspage \cc@abspage\z@
\def\thecc@abspage{\the\cc@abspage}
\newif\if@cc@odd \@cc@oddtrue
\AtBeginDocument{%
  \global\cc@abspage=\c@page\relax%
  \g@addto@macro\@outputpage{\global\cc@abspage\c@page}%
}
\def\ccTestPage{%
  \expandafter\ifx\csname the@cc@thispage\endcsname\@empty
    \gdef\the@cc@atthispage{1}%
  \else
    \expandafter\ifnum \the@cc@thispage=\cc@abspage%
      \begingroup
        \@tempcnta\the@cc@atthispage\relax
        \advance\@tempcnta\@ne\relax
        \xdef\the@cc@atthispage{\the\@tempcnta}%
      \endgroup
    \else
      \gdef\the@cc@atthispage{1}%
    \fi
  \fi
  \xdef\the@cc@thispage{\the\cc@abspage}%
  \let\@cc@currpage\relax
  \expandafter\ifx\csname \cc@cur@cont-\the@cc@thispage-\the@cc@atthispage\endcsname\relax
    \ifodd\cc@abspage\relax\@cc@oddtrue\else\@cc@oddfalse\fi
  \else
    \edef\@cc@currpage{\expandafter\expandafter\expandafter\@firstofone\csname \cc@cur@cont-\the@cc@thispage-\the@cc@atthispage\endcsname}%
    \ifodd\@cc@currpage\relax\@cc@oddtrue\else\@cc@oddfalse\fi
  \fi
}
\def\ccSavePage{%
  \protected@write\@auxout{\def\the@cc@cur@cont{\cc@cur@cont}\let\thecc@abspage\relax}{%
    \string\expandafter\string\gdef\string\csname\space \cc@cur@cont-\the@cc@thispage-\the@cc@atthispage\string\endcsname{\thecc@abspage}}%
}
\DeclareRobustCommand*{\ccBreak}{\hfill\break}
\ifx\ccPrefix\@empty\else\cslet{\ccPrefix break}\ccBreak\fi
\def\cc@init@l@{\cc@opt@empty\@cc@init@l@}%
\def\@cc@init@l@[#1]#2#3#4{%
  \expandafter\ifx\csname c@#2depth\endcsname\relax
    \expandafter\global\expandafter\newcount\csname c@#2depth\endcsname
    \expandafter\global\csname c@#2depth\endcsname=0\relax
  \fi
  \expandafter\ifx\csname cc@#2@extract@data\endcsname\relax
    \expandafter\let\csname cc@#2@extract@data\endcsname\cc@extract@generic
  \fi
  \expandafter\ifx\csname cc@#2@print@entry\endcsname\relax
    \expandafter\let\csname cc@#2@print@entry\endcsname\cc@print@generic
  \fi
  \expandafter\long\expandafter\gdef\csname cc@l@#4\endcsname##1##2{%
    \ifLuaTeX\suppresslongerror=1\fi
    \expandafter\ifnum \csname c@#2depth\endcsname<#3\relax
    \else
      \bgroup
        \long\def\ccTocLink####1{\hyper@linkstart{link}{\@contentsline@destination}{####1}\hyper@linkend}%
        \csname cc@#2@extract@data\endcsname{#3}{#4}{##1}{##2}%
        \csname cc@#2@print@entry\endcsname{#4}%
      \egroup
    \fi
    \ifLuaTeX\suppresslongerror=0\fi
  }}
\long\def\ccContentsline#1#2#3#4{\gdef\@contentsline@destination{#4}%
  \csname cc@l@#1\endcsname{#2}{#3}}
\def\cc@extract@generic#1#2#3#4{}
\def\cc@print@generic#1{}
\def\cc@expand@l@contents#1#2#3#4{%
  \global\let\cc@tempa\relax
  \sbox\z@{\def\numberline##1{\xdef\cc@tempa{\noexpand\csdef{cc@#2@#3Number}{##1}}}#1}%
  \ifdim\wd\z@>\z@
    \let\numberline\@gobble%
    \protected@csedef{cc@#2@#3#4}{#1}%
    \cc@tempa
  \else
    #1%
  \fi
  \global\let\cc@tempa\relax
}
\def\ccDeclareContentList#1#2{%
  \def\cc@add@extra@cl##1{%
    \expandafter\ifx\csname cc@##1@extra@cl\endcsname\relax
      \csgdef{cc@##1@extra@cl}{#1}%
    \else
      \csgappto{cc@##1@extra@cl}{,#1}%
    \fi}%
  \edef\@argii{#2}%
  \cc@parse@csv\cc@add@extra@cl{@argii}%
  \expandafter\newwrite\csname cc@cl@#1\endcsname\relax
}
\def\ccCreateContentListEntries#1#2#3#4#5{%
  \def\cc@add@extra@cl##1{%
    \expandafter\protected@write\csname cc@cl@##1\endcsname
      {\ccGobble\ccaProtect}%
      {\protect\ccContentsline{#2}{#3}{#4}{#5}\protected@file@percent}\relax
    \expandafter\protected@write\csname cc@cl@##1\endcsname
      {\ccaEnable}{}%
  }%
  \ifcsdef{cc@#1@extra@cl}{%
    \cc@parse@csv\cc@add@extra@cl{cc@#1@extra@cl}}{}%
}
\def\cc@store@latest#1#2{%
  \expandafter\ifx\csname cc-\cc@cur@cont-#1\endcsname\relax
    \csxdef{cc-\cc@cur@cont-#1}{#2}%
  \else
    \expandafter\ifdim\csname cc-\cc@cur@cont-#1\endcsname<#2\relax
      \csxdef{cc-\cc@cur@cont-#1}{#2}%
    \fi
  \fi
  \expandafter\ifx\csname cc-\cc@cur@cont-#1-local\endcsname\relax
    \csxdef{cc-\cc@cur@cont-#1-local}{#2}%
  \else
    \expandafter\ifdim\csname cc-\cc@cur@cont-#1-local\endcsname<#2\relax
      \csxdef{cc-\cc@cur@cont-#1-local}{#2}%
    \fi
  \fi
  \ifcsdef{cc-\cc@cur@cont-#1-stored-trigger}{}
    {\edef\@tempa{%
       \noexpand\immediate\noexpand\write\noexpand\@auxout{%
         \noexpand\string\noexpand\csgdef{cc-\cc@cur@cont-#1}{%
           \noexpand\csname cc-\cc@cur@cont-#1-local\noexpand\endcsname}}}%
     \expandafter\AtEndDocument\expandafter{\@tempa}%
     \csgdef{cc-\cc@cur@cont-#1-stored-trigger}{\@empty}}}
\def\cc@format@number#1#2#3{%
  \ccSetPropertyVal{#1curr-number-level}{#3}%
  \ccIfComp{#2Number}
    {\sbox\z@{\ccUseProperty{#1number-format}}}
    {\sbox\z@{}}%
  \cc@store@latest{#1number-#3-maxwd}{\the\wd\z@}%
  \cc@store@latest{#1number-maxwd}{\the\wd\z@}%
  \ccSetPropertyVal{#1number-width-level-max}{\csname cc-\cc@cur@cont-#1number-#3-maxwd\endcsname}%
  \ccSetPropertyVal{#1number-width-max}{\csname cc-\cc@cur@cont-#1number-maxwd\endcsname}%
  \ccSetPropertyVal{#1number-width}{\the\wd\z@}%
  \cc@get@indent{#1}{#3}%
  \cc@set@hang{#1}%
}
\def\cc@set@hang#1{%
  \ccPropertyLet{#1hang-number}{#1number-format}%
  \ccIfProp{#1indent}
    {\ifdim\ccUseProperty{#1indent}<\z@
       \ccSetProperty{#1hang-number}{%
         \hskip\ccUseProperty{#1indent}%
         \hbox to -\ccUseProperty{#1indent}{%
           \ccIfPropVal{#1number-align}{left}{}{\hss}%
           \ccUseProperty{#1number-format}%
           \ccIfPropVal{#1number-align}{right}{}{\hss}}}%
     \fi}{}}
\def\cc@calc@margin@left#1#2{%
  \@tempcnta\numexpr#2-\@ne\relax
  \expandafter\ifx\csname cc-\cc@cur@cont-#1\the\@tempcnta-margin-left\endcsname\relax
    \@tempdima=-\ccUseProperty{#1indent}\relax%
  \else
    \@tempdima=\dimexpr\csname cc-\cc@cur@cont-#1\the\@tempcnta-margin-left\endcsname-\ccUseProperty{#1indent}\relax
  \fi
  \cc@store@latest{#1#2-margin-left}{\the\@tempdima}%
  \ccSetProperty{#1margin-left}{\the\@tempdima}}
\def\cc@get@indent{\@ifnextchar[{\@cc@get@indent}{\@cc@get@indent[\cc@calc@margin@left]}}
\def\@cc@get@indent[#1]#2#3{%
  \ccPropertyLetX{int-#2margin-left}{#2margin-left}%
  \ccPropertyLetX{int-#2indent}{#2indent}%
  \ccIfPropVal{#2indent}{auto-global}
    {\ccSetPropertyX{#2indent}{-\ccUseProperty{#2number-width-max}}%
     \ccIfPropVal{#2margin-left}{auto}{\ccSetProperty{#2margin-left}{}}{}%
     \ccIfPropVal{#2margin-left}{}
       {\ccSetProperty{int-#2margin-left}{\z@}}
       {\ccPropertyLetX{int-#2margin-left}{#2margin-left}}%
     \ccSetPropertyX{#2margin-left}{\dimexpr\ccUseProperty{#2number-width-max}+\ccUseProperty{int-#2margin-left}\relax}}
    {\ccIfPropVal{int-#2margin-left}{auto}
       {\ccIfPropVal{int-#2indent}{auto}
          {\ccSetPropertyX{#2indent}{-\ccUseProperty{#2number-width-level-max}}}
          {\ccIfProp{int-#2indent}
             {\ccSetPropertyX{#2indent}{\ccUseProperty{int-#2indent}}}
             {\ccSetProperty{#2indent}{\z@}}}%
        #1{#2}{#3}}
       {\ccIfProp{int-#2margin-left}
          {\ccIfPropVal{int-#2indent}{auto}
            {\ccSetPropertyX{#2indent}{-\ccUseProperty{#2number-width-level-max}}}
            {\ccIfProp{int-#2indent}
               {\ccSetPropertyX{#2indent}{\ccUseProperty{int-#2indent}}}
               {\ccSetProperty{#2indent}{\z@}}}}
         {\ccIfPropVal{int-#2indent}{auto}
            {\ccPropertyLetX{#2margin-left}{#2number-width-level-max}%
             \ccSetPropertyX{#2indent}{-\ccUseProperty{#2number-width-level-max}}}
            {\ccIfProp{int-#2indent}
               {\ccSetPropertyX{#2indent}{\ccUseProperty{int-#2indent}}%
                \ccSetProperty{#2margin-left}{\z@}}
               {\ccSetProperty{#2indent}{\z@}%
                \ccSetProperty{#2margin-left}{\z@}}}}}}}
\AtBeginDocument{%
  \global\let\cc@ltx@label\label
}
\def\ccCreateLabel#1{%
  \ifx\Hy@MakeCurrentHrefAuto\@undefined\else
    \Hy@MakeCurrentHrefAuto{cc:#1}%
    \Hy@raisedlink{\hyper@anchorstart{\@currentHref}\hyper@anchorend}%
  \fi
  \let\cc@ref@label\relax
  \ccWhenComp{RefLabel}
    {\ccgdefFromComp\cc@ref@label{RefLabel}%
     \expandafter\cc@create@label\expandafter{\cc@ref@label}}%
  \ccIfAttr{\cc@cur@cont}{label}
    {\cc@parse@csv\cc@create@label{cc@\cc@cur@cont @attr@label}}%
    {\ifx\cc@ref@label\relax\cc@create@label{\@currentHref}\fi}}
\def\cc@create@label#1{%
  \ccIfComp{Number}
  {\ifx\cc@labelname@comp\@undefined
      \def\cc@labelname@comp{Title}%
    \fi
    \begingroup
      \ccGobble\ccaProtect
      \ccgdefFromComp\@currentlabel{Number}%
      \ccgdefFromComp\@currentlabelname{\cc@labelname@comp}%
    \endgroup}%
  {\cc@fallback@anchor}%
  %% leaving this will generate lots of "duplicate destination"
  %% messages from pdfbackend
  %\expandafter\hypertarget\expandafter{#1}{}%
  \@tempswafalse\ifx\cc@saved@ccaStructStart\ccaStructStart\@tempswatrue\fi
  \ccaProtect
  \expandafter\label\expandafter{#1}%
  \if@tempswa\ccaEnable\else\ccaDisable\fi
}
\def\cc@fallback@anchor{\phantomsection}%
\def\ccSetBabelLabel#1#2#3{%
  \def\ccc@lang{#1}%
  \expandafter\def\expandafter\ccc@tempa\expandafter{\expandafter\def\csname #2name\endcsname{#3}}%
  \ifdefstring\ccc@lang{german}{%
    \expandafter\addto\expandafter\captionsgerman\expandafter{\ccc@tempa}%
    \expandafter\addto\expandafter\captionsngerman\expandafter{\ccc@tempa}%
  }\relax%
  \ifdefstring\ccc@lang{english}{%
    \expandafter\addto\expandafter\captionsbritish\expandafter{\ccc@tempa}%
    \expandafter\addto\expandafter\captionsUKenglish\expandafter{\ccc@tempa}%
    \expandafter\addto\expandafter\captionsenglish\expandafter{\ccc@tempa}%
    \expandafter\addto\expandafter\captionsamerican\expandafter{\ccc@tempa}%
    \expandafter\addto\expandafter\captionsUSenglish\expandafter{\ccc@tempa}%
  }\relax%
}
\def\ccCompLink#1#2{%
  \protected@edef\@argi{\expandonce{\ccUseComp{#1}}}%
  \expandafter\href\expandafter{\@argi}{#2}%
}
\def\ccPageLabel#1{\phantomsection\label{#1}}
\endinput
%%
%% End of file `coco-common.sty'.
