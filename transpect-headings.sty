%%
%% This is file `transpect-headings.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% transpect.dtx  (with options: `headings')
%% 
%% IMPORTANT NOTICE:
%% 
%% For the copyright see the source file.
%% 
%% Any modified versions of this file must be renamed
%% with new filenames distinct from transpect-headings.sty.
%% 
%% For distribution of the original source see the terms
%% for copying and modification in the file transpect.dtx.
%% 
%% This generated file may be distributed as long as the
%% original source files, as listed above, are part of the
%% same distribution. (The sources need not necessarily be
%% in the same archive or directory.)
\def\fileversion{0.97}%
\def\filedate{2021-02-25}%
%%
%% module for le-tex transpect.cls that extends heading objects.
%%
%% Maintainer: p.schulz@le-tex.de
%%
%% lualatex  -  texlive >= 2019
%%
\NeedsTeXFormat{LaTeX2e}[2019/01/01]
\ProvidesPackage{transpect-headings}
    [\filedate \fileversion le-tex transpect headings module]
\RequirePackage{transpect-common}
\RequirePackage{bookmark}
\hypersetup{bookmarksdepth=-999}
\long\def\tpDeclareHeading{\@ifnextchar[{\@tpDeclareHeading}{\@tpDeclareHeading[]}}%]
\long\def\@tpDeclareHeading[#1]#2#3#4{%
  \tpNamespace{heading}%
  \expandafter\def\csname heading@#3@name\endcsname{#3}%
  %
  \if!#1!\else\expandafter\protect\expandafter\def\csname tp@heading@#3@parent\endcsname{#1}\fi%
  \expandafter\protect\expandafter\def\csname tp@heading@#3@properties\endcsname{#4}%
  %
  %
  %
  \expandafter\def\csname tpUseHeading#3\endcsname{%
    \@setpar{\@@par}%
    \tpNamespace{heading}%
    \tpCascadeProps{#3}{heading}%
    \tpUseProperty{heading-par}%
    \tpUseProperty{before-heading}%
    \everypar{}%
    \tp@number@props
    \tpIfProp{after-skip}{\expandafter\@tempskipa\expandafter=\tpUseProperty{after-skip}\relax}{\@tempskipa=1sp\relax}%
    \def\@svsec{%
      \tpUseProperty{before-heading-block}
      {\tpUseProperty{heading-block}}%
      \tpUseProperty{after-heading-block}%
    }%
    \ifdim\@tempskipa <\z@\relax
      \tp@inline@heading
    \else
      \tp@block@heading
    \fi
    \aftergroup\next%
  }}

\tpAddToDefault{heading}{%
  \tpSetProperty{interline-para}{}%
  \tpSetProperty{heading-par}{%
    \tpIfProp{interline-para}{\if@noskipsec \leavevmode \fi}{}%
    \@@par\global\@afterindenttrue}%
  \tpSetProperty{before-heading}{}%
  \tpSetProperty{after-heading-block}{}%
  \tpSetProperty{before-heading-block}{\parindent\z@ \parskip\z@}%
  \tpSetProperty{after-indent}{}%
  \tpSetProperty{after-skip}{1sp}%
  \tpSetProperty{number-sep}{\space}%
  \tpSetProperty{title-format}{\raggedright}%
  \tpSetProperty{number-width}{}
}

\def\tp@number@props{%
  \sbox\z@{\tpUseProperty{title-format}\tpUseMacro{Number}\tpUseProperty{number-sep}}\tpSetProperty{number-width}{\the\wd\z@}%
  \def\tpHangNumber##1{\leftskip##1\hskip-##1\hbox to##1{\tpUseProperty{title-format}\tpUseMacro{Number}}}%
}

\def\tp@inline@heading{%
  \tpIfProp{after-indent}{\global\@afterindenttrue}{\global\@afterindentfalse}%
  \tpIfProp{interline-para}
    {\global\setbox\@tempboxa\hbox{\@svsec}}
    {\global\setbox\@tempboxa\hbox{\ifvoid\@tempboxa\else\unhbox\@tempboxa\tpInterlineParaSep\fi\@svsec}}%
  \@nobreakfalse
  \global\@noskipsectrue
  \gdef\next{%
    \global\everypar{%
      \if@noskipsec
        \global\@noskipsecfalse
        {\setbox\z@\lastbox}%
        \clubpenalty\@M
        \begingroup \unhbox\@tempboxa \endgroup
        \unskip
        \hskip -\@tempskipa
      \else
        \clubpenalty \@clubpenalty
        \global\setbox\@tempboxa\box\voidb@x
        \everypar{}%
      \fi}%
    \ignorespaces
  }}

\def\tp@block@heading{%
  \@svsec
  \par \nobreak
  \tpIfProp{after-indent}{\global\@afterindenttrue}{\global\@afterindentfalse}%
  \gdef\next{%
    \vskip \@tempskipa
    \@afterheading}}


\def\tp@provide@hd@macros#1{%
  \tpProvideMacro{tp#1}{}{}{#1}%
  \tpProvideMacro{tpToc#1}{}{}{Toc#1}%
  \tpProvideMacro{tpRun#1}{}{}{Run#1}%
}

\def\heading{\@ifnextchar [{\@heading}{\@heading[]}}%]
\DeclareRobustCommand{\TitleBreak}{\hfill\break}

\def\@heading[#1]#2{%
  \tp@heading@reserve
  \tpParseAttributes{heading}{#1}%
  \edef\tp@heading@name{#2}%
  \tp@heading@load@props{#2}%
  \tpProvideMacro{tpLabel}{}{}{Label}%
  \tp@provide@hd@macros{Author}%
  \tp@provide@hd@macros{Title}%
  \tp@provide@hd@macros{Subtitle}%
  \tp@provide@hd@macros{Number}%
  \tpProvideMacro{tpQuote}{}{}{Quote}%
  \tpProvideMacro{tpQuoteSource}{}{}{QuoteSource}%
}
\def\tp@heading@load@props#1{%
  \csname tp@heading@#1@properties\endcsname
}
\def\endheading{%
  \expandafter\ifx\csname tpUseHeading\tp@heading@name\endcsname\relax
    \PackageError{transpect.cls}{Heading level \tp@heading@name\space unknown!}{A Heading with level \tp@heading@name\space is unknown. Use the \string\tpDeclareHeading\space macro to declare heading levels.}%
  \else
    \afterfi\csname tpUseHeading\tp@heading@name\endcsname%
  \fi
  \tp@heading@reset
  \nopagebreak
}
\def\tp@heading@reserve{%
  \tpNamespace{heading}%
  \let\ltx@dbl@backslash\\
  \let\\\TitleBreak
  \let\ltx@label\label
  \let\tp@heading@label\relax
  \let\tp@notoc\@empty
}
\def\tp@heading@reset{%
  \let\tp@namespace\relax
  \let\\\ltx@dbl@backslash
  \let\label\ltx@label
  \let\tp@heading@name\relax
  \let\tp@heading@label\relax
  \let\tp@notoc\@empty
}
\def\tp@init@l@#1#2{%
  \tp@toc@init@options{#1}{#2}%
  \ifnum#2>\c@tocdepth
    \expandafter\let\csname l@#1\endcsname\@gobbletwo
  \else
    \expandafter\def\csname l@#1\endcsname##1##2{%
      \bgroup
        \tp@toc@extract@data{##1}{##2}%
        \tp@toc@print@entry{#1}%
      \egroup
    }%
  \fi
}
\def\tp@toc@extract@data#1#2{%
  \def\tp@toc@page{#2}% page number from .toc
  \def\tpToCSubTitle##1{\def\tp@toc@subtitle{##1}}%
  \def\numberline##1{\def\tp@toc@number{##1}}%
  \def\tpTocAuthor##1{\def\tp@toc@author{##1}}%
  \setbox\z@\hbox{#1}%
  \let\tpTocSubTitle\@gobble
  \let\numberline\@gobble
  \let\tpTocAuthor\@gobble
  \protected@edef\tp@toc@title{#1}%
}

\def\tp@toc@print@entry#1{%
  \csname tp@toc@order@#1\endcsname\@par
  % ENTRY Level: #1
  % Author: \ifx\tp@toc@author\@undefined nil\else\meaning\tp@toc@author\fi\\
  % Number: \ifx\tp@toc@number\@undefined nil\else\meaning\tp@toc@number\fi\\
  % Title: \ifx\tp@toc@title\@undefined nil\else\meaning\tp@toc@title\fi\\
  % Subtitle: \ifx\tp@toc@subtitle\@undefined nil\else\meaning\tp@toc@subtitle\fi\\
  % Page: \ifx\tp@toc@page\@undefined nil\else\meaning\tp@toc@page\fi\@par
}
\def\tp@toc@init@options#1#2{%
  \def\tpToCOrder##1{\tp@toc@order{#1}{##1}}%
  \tpToCOrder{author,title,subtitle,page}% default
  %%
  \let\tpToCBefore\@gobble
  \let\tpToCAfter\@gobble
  \let\tpToCFormat\@gobble
  \let\tpToCPageSep\@gobble
  \let\tpToCNumSep\@gobble
  \let\tpToCNoPage\relax
  \let\tpToCHangNumber\relax
  \let\tpToCHangFixed\@gobble
  \let\tpToCAlign\@gobble
  \let\tpToCPageOut\@gobble
  \let\tpToCSubTitle\relax
  \let\tpToCSubTitleBefore\@gobble
  \let\tpToCSubTitleAfter\@gobble
  \let\tpToCSubTitleFormat\@gobble
}
\def\tp@toc@order#1#2{%
  \def\tpToCUse##1{\csname tp@use@toc@##1\endcsname{#1}}%
  \expandafter\gdef\csname tp@toc@order@#1\endcsname{%
    #2}}

\def\tp@use@toc@author#1{\ifx\tp@toc@author\@undefined\else \tp@toc@author\fi}
\def\tp@use@toc@title#1{\ifx\tp@toc@title\@undefined\else \tp@toc@title\fi}
\def\tp@use@toc@subtitle#1{\ifx\tp@toc@subtitle\@undefined\else  \tp@toc@subtitle\fi}
\def\tp@use@toc@page#1{\ifx\tp@toc@page\@undefined\else \tp@toc@page\fi}








\endinput
%%
%% End of file `transpect-headings.sty'.
