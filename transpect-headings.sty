%%
%% This is file `transpect-headings.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% transpect.dtx  (with options: `headings')
%% 
%% IMPORTANT NOTICE:
%% 
%% For the copyright see the source file.
%% 
%% Any modified versions of this file must be renamed
%% with new filenames distinct from transpect-headings.sty.
%% 
%% For distribution of the original source see the terms
%% for copying and modification in the file transpect.dtx.
%% 
%% This generated file may be distributed as long as the
%% original source files, as listed above, are part of the
%% same distribution. (The sources need not necessarily be
%% in the same archive or directory.)
\def\fileversion{0.97}%
\def\filedate{2021-02-25}%
%%
%% module for le-tex transpect.cls that extends heading objects.
%%
%% Maintainer: p.schulz@le-tex.de
%%
%% lualatex  -  texlive >= 2019
%%
\NeedsTeXFormat{LaTeX2e}[2019/01/01]
\ProvidesPackage{transpect-headings}
    [\filedate \fileversion le-tex transpect headings module]
\RequirePackage{bookmark}
\hypersetup{bookmarksdepth=-999}
\def\tpDeclareHeading{\@ifnextchar[{\@tpDeclareHeading}{\@tpDeclareHeading[]}}%]
\def\@tpDeclareHeading[#1]#2#3#4{%
  \tpNamespace{heading}%
  \expandafter\gdef\csname tp@decl@#3\endcsname{#4}%
  \global\let\tp@inherit\relax
  \if!#1!\else
    \xdef\tp@inherit{#1}%
    \expandafter\xdef\csname tp@inherit@#3\expandafter\endcsname{#1}%
  \fi
  \expandafter\def\csname heading@#3@name\endcsname{#3}%
  \def\tpHeadingProperty##1##2{%
    \ifx\tp@inherit\relax\else\tpDeclareHook{##1#3}\fi
    \tpAddToHook{##1#3}{##2}%
  }%
  \tpDeclareBlock{Author}{#3}%
  \tpDeclareBlock{Subtitle}{#3}%
  \tpDeclareBlock{Quote}{#3}%
  \tpDeclareBlock{QuoteSource}{#3}%
  \tpDeclareBlock{Number}{#3}%
  \tpDeclareHook{BlockFormat#3}%
  \tpDeclareHook{BeforeHeading#3}%
  \tpDeclareHook{AfterHeading#3}%
  \tpDeclareHook{AfterSkip#3}%
  \tpDeclareHook{TitleFormat#3}%
  \def\tpAfterTitle##1{\expandafter\gdef\csname tp@after@title@#3\endcsname{##1}}%
  \tpDeclareHook{BeforeBox#3}%
  \tpDeclareHook{AfterBox#3}%
  \tpDeclareHook{AfterTitles#3}%
  \def\tpAfterIndent{\expandafter\global\expandafter\let\csname tp@fter@indent@#3\endcsname\@empty}%
  \def\tpAuthorAfter{\expandafter\global\expandafter\let\csname tp@author@fter@#3\endcsname\@empty}%
  \def\tpAuthorAfterIndent{\expandafter\global\expandafter\let\csname tp@author@fter@indent@#3\endcsname\@empty}%
  \def\tpHeadingPar{%
    \ifx\tp@interline@paragraphs\relax\else
      \if@noskipsec \leavevmode \fi
    \fi
    \@@par\@afterindenttrue
  }%
  \def\tpInterlineParagraphs{\global\let\tp@interline@paragraphs\relax}%
  \def\tpInterlineParaSep{\space}%
  \def\tpHideAuthor{\expandafter\global\expandafter\let\csname tp@hide@uthor@#3\endcsname\@empty}%
  \def\tpHangNumber{\expandafter\global\expandafter\let\csname tp@hang@number@#3\endcsname\@empty}%
  \def\tpNoToc{\expandafter\global\expandafter\let\csname tp@no@toc@#3\endcsname\@empty}%
  \def\tpToCNoNumber{\expandafter\global\expandafter\let\csname tp@toc@no@number@#3\endcsname\@empty}%
  \def\tpHangFixed##1{\expandafter\gdef\csname tp@hang@fixed@#3\endcsname{##1}}%
  \tpHangFixed{\z@}%
  \tp@init@l@{#3}{#2}%
  \ifx\tp@inherit\relax\else
    \csname tp@decl@\tp@inherit\endcsname
  \fi
  \csname tp@decl@#3\endcsname
  \expandafter\def\csname tpUseHeading#3\endcsname{%
    \expandafter\let\expandafter\tp@inherit@name\csname tp@inherit@#3\endcsname
    \expandafter\ifx\csname tp@hook@heading@AfterSkip#3\endcsname\@empty
      \global\@tempskipa=1sp\relax
    \else
      \expandafter\expandafter\expandafter\global\expandafter\expandafter\@tempskipa\expandafter=\csname tp@hook@heading@AfterSkip#3\endcsname\relax%
    \fi
    \expandafter\ifx\csname tp@after@title@#3\endcsname\relax
      \ifdim\@tempskipa<\z@\relax\else
        \expandafter\global\expandafter\let\csname tp@after@title@#3\endcsname\par
      \fi
    \fi
    \xdef\tp@heading@level{#2}%
    \edef\Hy@toclevel{\csname toclevel@#2\endcsname}%
    \tpHeadingPar
    \tpUseHook{BeforeHeading#3}%
    \everypar{}%
    \ifx\Hy@MakeCurrentHrefAuto\@undefined\else
      \Hy@MakeCurrentHrefAuto{#3}%
      \Hy@raisedlink{\hyper@anchorstart{\@currentHref}\hyper@anchorend}%
    \fi
    \ifx\tp@heading@label\relax\else
      \ifx\tp@heading@Number\relax
      \else
        \let\@currentlabel\tp@heading@Number
        \let\@currentlabelname\tp@heading@Title
        \expandafter\ltx@label\expandafter{\tp@heading@label}%
      \fi
    \fi
    \global\let\label\ltx@label
    \expandafter\let\expandafter\tp@mark@name\csname #3mark\endcsname%
    \ifx\tp@mark@name\relax
      \ifx\tp@inherit@name\relax\else
        \expandafter\let\expandafter\tp@mark@name\csname \tp@inherit@name mark\endcsname
      \fi
    \fi
    \ifx\tp@mark@name\relax
    \else
      \ifx\tp@heading@Runtitle\relax
        \ifx\tp@heading@Number\relax
          \protected@edef\@tp@mark@name{\tp@heading@Title}%
        \else
          \protected@edef\@tp@mark@name{\noexpand\numberline{\tp@heading@Number}\tp@heading@Title}%
        \fi
      \else
        \protected@edef\@tp@mark@name{\tp@heading@Runtitle}%
      \fi
      \expandafter\tp@mark@name\expandafter{\@tp@mark@name}%
    \fi
    \expandafter\ifx\csname tp@no@toc@#3\endcsname\@empty\else
      \expandafter\ifx\tp@notoc\relax
        \let\tp@notoc\@empty
      \else
        \expandafter\ifnum\tp@heading@level>\c@tocdepth\relax\else
          \ifx\tp@heading@Toctitle\relax
            \edef\tp@heading@Toctitle{%
              \expandafter\ifx\csname tp@toc@no@number@#3\endcsname\@empty\else
                \ifx\tp@heading@Number\relax\else
                  \noexpand\protect\noexpand\numberline{\tp@heading@Number}%
                \fi
              \fi
              \ifx\tp@heading@Subtitle\relax\else
                \noexpand\protect\noexpand\tpToCSubTitle{\tp@heading@Subtitle}%
              \fi
              \ifx\tp@heading@Tocauthor\relax
                \ifx\tp@heading@Author\relax\else
                  \noexpand\protect\noexpand\tpToCAuthor{\tp@heading@Author}%
                \fi
              \else
                  \noexpand\protect\noexpand\tpToCAuthor{\tp@heading@Tocauthor}%
              \fi
              \expandonce{\tp@heading@Title}%
            }%
          \fi
          \addcontentsline{toc}{#3}{\expandonce{\tp@heading@Toctitle}}\relax
          \edef\tp@heading@BMtitle{%
            \ifx\tp@heading@Tocauthor\relax
              \ifx\tp@heading@Author\relax\else
                \noexpand\protect\noexpand\tpToCAuthor{\tp@heading@Author}%
              \fi
            \else
              \noexpand\protect\noexpand\tpToCAuthor{\tp@heading@Tocauthor}%
            \fi
            \expandafter\ifx\csname tp@toc@no@number@#3\endcsname\@empty\else
              \ifx\tp@heading@Number\relax\else
                \noexpand\protect\noexpand\Hy@numberline{\tp@heading@Number}%
              \fi
            \fi
            \expandonce{\tp@heading@Title}%
          }%
          \bookmark[level=#2,dest=\@currentHref]{\expandonce{\tp@heading@BMtitle}}%
        \fi
      \fi
    \fi
    \def\@svsec{%
      \tpUseHook{BeforeBox#3}%
      \bgroup
        \parindent\z@ \parskip\z@
        \tpUseHook{BlockFormat#3}%
        \expandafter\ifx\csname tp@hide@uthor@#3\endcsname\relax
          \expandafter\ifx\csname tp@author@fter@#3\endcsname\relax
            \expandafter\ifx\csname tp@author@fter@indent@#3\endcsname\relax
              \tpUseBlock{Author}{#3}%
            \fi
          \fi
        \fi
        \@tempdimb\z@
        \ifx\tp@heading@Number\relax\else
          \expandafter\ifx\csname tp@hang@number@#3\endcsname\@empty
            \expandafter\@tempdimb\dimexpr\csname tp@hang@fixed@#3\endcsname\relax
            \ifdim\@tempdimb>\z@\relax\else
              \setbox\z@\hbox{\tpUseHook{TitleFormat#3}\tpUseBlock{Number}{#3}\strut}%
              \@tempdimb\wd\z@
            \fi
          \fi
        \fi
        \bgroup
          \leftskip\@tempdimb
          \hskip-\@tempdimb
          {\tpUseHook{TitleFormat#3}%
            \tpUseBlock{Number}{#3}%
            \tp@heading@Title
            \csname tp@after@title@#3\endcsname
          }%
          \tpUseBlock{Subtitle}{#3}%
          \expandafter\ifx\csname tp@hide@uthor@#3\endcsname\relax
            \expandafter\ifx\csname tp@author@fter@#3\endcsname\relax\else
              \tpUseBlock{Author}{#3}%
            \fi
          \fi
        \egroup
        \tpUseHook{AfterTitles#3}%
        \expandafter\ifx\csname tp@hide@uthor@#3\endcsname\relax
          \expandafter\ifx\csname tp@author@fter@indent@#3\endcsname\relax\else
            \tpUseBlock{Author}{#3}%
          \fi
        \fi
        \tpUseBlock{Quote}{#3}%
        \tpUseBlock{QuoteSource}{#3}%
        \ifx\tp@heading@Number\relax
          \expandafter\global\expandafter\let\csname the#3\endcsname\@empty%
        \else
          \expandafter\xdef\csname the#3\endcsname{\tp@heading@Number}%
        \fi
        \tpUseHook{AfterBox#3}%
      \egroup
      \tpUseHook{AfterHeading#3}%
    }%
    \ifdim\@tempskipa <\z@\relax
      \expandafter\ifx\csname tp@fter@indent@#3\endcsname\relax
        \global\@afterindentfalse
      \else
        \global\@afterindenttrue
      \fi
      \ifx\tp@interline@paragraphs\relax
        \global\setbox\@tempboxa\hbox{\ifvoid\@tempboxa\else\unhbox\@tempboxa\tpInterlineParaSep\fi\@svsec}%
      \else
        \global\setbox\@tempboxa\hbox{\@svsec}%
      \fi
      \@nobreakfalse
      \global\@noskipsectrue
      \gdef\next{%
        \global\everypar{%
          \if@noskipsec
            \global\@noskipsecfalse
            {\setbox\z@\lastbox}%
            \clubpenalty\@M
            \begingroup \unhbox\@tempboxa \endgroup
            \unskip
            \hskip -\@tempskipa
          \else
            \clubpenalty \@clubpenalty
            \global\setbox\@tempboxa\box\voidb@x
            \everypar{}%
          \fi}%
        \ignorespaces
      }%
    \else
      \@svsec
      \par \nobreak
      \gdef\next{%
        \vskip \@tempskipa
        \expandafter\ifx\csname tp@fter@indent@#3\endcsname\relax
          \global\@afterindentfalse
        \else
          \global\@afterindenttrue
        \fi
        \@afterheading}%
    \fi
    \aftergroup\next%
  }}
\def\@xminusvskip{%
  \ifdim\lastskip<\@tempskipb
  \else
    \ifdim\@tempskipb<\z@
      \ifdim\lastskip<\z@
      \else
        \advance\@tempskipb\lastskip
        \vskip-\lastskip
        \vskip \@tempskipb
      \fi
    \fi
  \fi}
\def\minusvspace#1{%
  \ifvmode
     \if@minipage\else
       \ifdim \lastskip =\z@
         \ifx\@vspace@calcify\@undefined
           \vskip #1\relax
         \else
           \@vspace@calcify{#1}%
         \fi
       \else
       \setlength\@tempskipb{#1}%
         \@xminusvskip
       \fi
     \fi
  \else
    \@noitemerr
  \fi}

\def\heading{\@ifnextchar [{\@heading}{\@heading[]}}%]

\DeclareRobustCommand{\TitleBreak}{\hfill\break}

\def\tp@parse@opt#1{\@tp@parse@opt#1,,\@nil}
\def\@tp@parse@opt#1,#2,\@nil{%
  \expandafter\ifx\csname tp@#1\endcsname\@empty
    \expandafter\global\expandafter\let\csname tp@#1\endcsname\relax
  \fi
  \if!#2!\else
    \@tp@parse@opt#2,\@nil
  \fi}

\def\@heading[#1]#2{%
  \bgroup
    \tpNamespace{heading}%
    \let\\\TitleBreak
    \global\let\ltx@label\label
    \global\let\tp@heading@label\relax
    \global\let\tp@notoc\@empty
    \global\let\tp@notocnumber\@empty
    \tp@parse@opt{#1}%
    \xdef\tp@heading@name{#2}%
    \tpProvideMacro{label}{}{}{label}%
    \tpProvideMacro{author}{}{}{Author}%
    \tpProvideMacro{title}{}{}{Title}%
    \tpProvideMacro{subtitle}{}{}{Subtitle}%
    \tpProvideMacro{toctitle}{}{}{Toctitle}%
    \tpProvideMacro{tocauthor}{}{}{Tocauthor}%
    \tpProvideMacro{runtitle}{}{}{Runtitle}%
    \tpProvideMacro{number}{}{}{Number}%
    \tpProvideMacro{quote}{}{}{Quote}%
    \tpProvideMacro{quotesource}{}{}{Quotesource}%
  }
\def\endheading{%
    \expandafter\ifx\csname tpUseHeading\tp@heading@name\endcsname\relax
      \PackageError{transpect.cls}{Heading level \tp@heading@name\space unknown!}{A Heading with level \tp@heading@name\space is unknown. Use the \string\tpDeclareHeading\space macro to declare heading levels.}%
    \fi
    \expandafter\aftergroup\csname tpUseHeading\tp@heading@name\endcsname
  \egroup
  \nopagebreak
}
\def\tp@init@l@#1#2{%
  \tp@toc@init@options{#1}{#2}%
  \ifnum#2>\c@tocdepth
    \expandafter\let\csname l@#1\endcsname\@gobbletwo
  \else
    \expandafter\def\csname l@#1\endcsname##1##2{%
      \bgroup
        \tp@toc@extract@data{##1}{##2}%
        \tp@toc@print@entry{#1}%
      \egroup
    }%
  \fi
}
\def\tp@toc@extract@data#1#2{%
  \def\tp@toc@page{#2}% page number from .toc
  \def\tpToCSubTitle##1{\def\tp@toc@subtitle{##1}}%
  \def\numberline##1{\def\tp@toc@number{##1}}%
  \def\tpTocAuthor##1{\def\tp@toc@author{##1}}%
  \setbox\z@\hbox{#1}%
  \let\tpTocSubTitle\@gobble
  \let\numberline\@gobble
  \let\tpTocAuthor\@gobble
  \protected@edef\tp@toc@title{#1}%
}

\def\tp@toc@print@entry#1{%
  \csname tp@toc@order@#1\endcsname\@par
  % ENTRY Level: #1
  % Author: \ifx\tp@toc@author\@undefined nil\else\meaning\tp@toc@author\fi\\
  % Number: \ifx\tp@toc@number\@undefined nil\else\meaning\tp@toc@number\fi\\
  % Title: \ifx\tp@toc@title\@undefined nil\else\meaning\tp@toc@title\fi\\
  % Subtitle: \ifx\tp@toc@subtitle\@undefined nil\else\meaning\tp@toc@subtitle\fi\\
  % Page: \ifx\tp@toc@page\@undefined nil\else\meaning\tp@toc@page\fi\@par
}
\def\tp@toc@init@options#1#2{%
  \def\tpToCOrder##1{\tp@toc@order{#1}{##1}}%
  \tpToCOrder{author,title,subtitle,page}% default
  %%
  \let\tpToCBefore\@gobble
  \let\tpToCAfter\@gobble
  \let\tpToCFormat\@gobble
  \let\tpToCPageSep\@gobble
  \let\tpToCNumSep\@gobble
  \let\tpToCNoPage\relax
  \let\tpToCHangNumber\relax
  \let\tpToCHangFixed\@gobble
  \let\tpToCAlign\@gobble
  \let\tpToCPageOut\@gobble
  \let\tpToCSubTitle\relax
  \let\tpToCSubTitleBefore\@gobble
  \let\tpToCSubTitleAfter\@gobble
  \let\tpToCSubTitleFormat\@gobble
}
\def\tp@toc@order#1#2{%
  \def\tpToCUse##1{\csname tp@use@toc@##1\endcsname{#1}}%
  \expandafter\gdef\csname tp@toc@order@#1\endcsname{%
    #2}}

\def\tp@use@toc@author#1{\ifx\tp@toc@author\@undefined\else \tp@toc@author\fi}
\def\tp@use@toc@title#1{\ifx\tp@toc@title\@undefined\else \tp@toc@title\fi}
\def\tp@use@toc@subtitle#1{\ifx\tp@toc@subtitle\@undefined\else  \tp@toc@subtitle\fi}
\def\tp@use@toc@page#1{\ifx\tp@toc@page\@undefined\else \tp@toc@page\fi}
\def\partmark#1{}%
\tpDeclareHeading{-1}{part}{%
  \tpHeadingProperty{BlockFormat}{\centering
    \markboth{}{}%
    \thispagestyle{empty}%
  }%
  \tpHeadingProperty{BeforeHeading}{\cleardoublepage\null\vskip10mm}%
  \tpHeadingProperty{AfterHeading}{\vfill}%
  \tpHeadingProperty{AuthorFormat}{\itshape}%
  \tpHeadingProperty{AfterAuthor}{\@@par\vskip2\baselineskip}%
  \tpHeadingProperty{TitleFormat}{\Huge}%
  \tpHeadingProperty{BeforeSubtitle}{\@@par\vskip\baselineskip}%
  \tpHeadingProperty{SubtitleFormat}{\leavevmode\vskip\baselineskip\large\bfseries}%
  \tpHeadingProperty{AfterNumber}{:\@@par}%
  \tpToCBefore{\vskip2\baselineskip}%
  \tpToCFormat{\bfseries}%
  \tpToCPageSep{\hfill}%
}

\tpDeclareHeading{0}{chapter}{%
  \tpHeadingProperty{BlockFormat}{\centering
    \markboth{}{}%
    \thispagestyle{empty}%
  }%
  \tpHeadingProperty{BeforeHeading}{\cleardoublepage\null\vskip10mm}%
  \tpHeadingProperty{AfterSkip}{3\baselineskip}%
  \tpHeadingProperty{AuthorFormat}{\itshape}%
  \tpHeadingProperty{AfterAuthor}{\@@par\vskip\baselineskip}%
  \tpHeadingProperty{TitleFormat}{\LARGE}%
  \tpHeadingProperty{SubtitleFormat}{\leavevmode\vskip\baselineskip\Large\bfseries}%
  \tpHeadingProperty{BeforeSubtitle}{\@@par\vskip.5\baselineskip}%
  \tpHeadingProperty{BeforeQuote}{\strut\@@par\vskip\baselineskip\hfil\hbox\bgroup\centering\vbox\bgroup\hsize.5\textwidth\centering}%
  \tpHeadingProperty{AfterQuote}{\egroup\egroup}%
  \tpHeadingProperty{AfterNumber}{:\enskip}%
  \tpToCBefore{\vskip1\baselineskip}%
  \tpToCFormat{\bfseries}%
  \tpToCPageSep{\bfseries\dotfill}%
  %%
  \tpHeadingProperty{AfterNumber}{:\enskip}%
}

\tpDeclareHeading{1}{section}{%
  \tpAuthorAfter
  \tpHangNumber
  %\tpHangFixed{12mm}%
  \tpHeadingProperty{BeforeHeading}{\vskip2\baselineskip}%
  \tpHeadingProperty{AfterSkip}{1\baselineskip}%
  \tpHeadingProperty{BeforeSubtitle}{ -- }%
  \tpHeadingProperty{BeforeAuthor}{\@@par}%
  \tpHeadingProperty{AuthorFormat}{\itshape}%
  \tpHeadingProperty{AfterAuthor}{\@@par}%
  \tpHeadingProperty{TitleFormat}{\Large}%
  \tpHeadingProperty{SubtitleFormat}{\Large}%
  \tpHeadingProperty{BeforeQuote}{\@@par\vskip.5\baselineskip}%
  \tpHeadingProperty{AfterNumber}{:\enskip}%
  % \tpHeadingProperty{AfterQuote}{\@@par\vskip.5\baselineskip}%
}

\tpDeclareHeading{2}{subsection}{%
  \tpHeadingProperty{BeforeHeading}{\vskip1.5\baselineskip}%
  \tpHeadingProperty{AfterSkip}{0.5\baselineskip}%
  \tpHeadingProperty{BeforeSubtitle}{ -- }%
  \tpHeadingProperty{AfterAuthor}{\@@par}%
  \tpHeadingProperty{TitleFormat}{\large}%
  \tpHeadingProperty{SubtitleFormat}{}%
  \tpHeadingProperty{BeforeQuote}{\@@par\vskip.5\baselineskip}%
  \tpHeadingProperty{AfterNumber}{:\enskip}%
}

\tpDeclareHeading{3}{subsubsection}{}

\tpDeclareHeading{4}{paragraph}{%
  \tpHeadingProperty{BeforeHeading}{\vskip1\baselineskip \@minus5bp}%
  \tpHeadingProperty{AfterSkip}{-.5em}%
  \tpHeadingProperty{BeforeSubtitle}{ -- }%
  \tpHeadingProperty{AfterAuthor}{\@@par}%
  \tpHeadingProperty{TitleFormat}{\normalsize\bfseries}%
  \tpHeadingProperty{SubtitleFormat}{}%
  \tpHeadingProperty{AfterNumber}{:\enskip}%
}

\let\ltx@ps@headings\ps@headings
\def\ps@headings{%
  \ltx@ps@headings
  \def\chaptermark##1{%
    \def\numberline####1{####1\enskip}%
    \markboth{%
      ##1
    }{}}%
  \def\sectionmark##1{%
    \def\numberline####1{####1\enskip}%
    \markright{##1}}%
}

\def\tpToCAuthor#1{#1: }

\endinput
%%
%% End of file `transpect-headings.sty'.
