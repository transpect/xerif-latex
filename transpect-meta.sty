%%
%% This is file `transpect-meta.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% transpect.dtx  (with options: `meta')
%% 
%% IMPORTANT NOTICE:
%% 
%% For the copyright see the source file.
%% 
%% Any modified versions of this file must be renamed
%% with new filenames distinct from transpect-meta.sty.
%% 
%% For distribution of the original source see the terms
%% for copying and modification in the file transpect.dtx.
%% 
%% This generated file may be distributed as long as the
%% original source files, as listed above, are part of the
%% same distribution. (The sources need not necessarily be
%% in the same archive or directory.)
\def\fileversion{0.2.0}%
\def\filedate{2021-05-23}%
%%
%%      module for le-tex transpect.cls that provides handling of a
%%      document's meta data.
%%
%% Maintainer: p.schulz@le-tex.de
%%
%% lualatex  -  texlive > 2019
%%
\NeedsTeXFormat{LaTeX2e}[2018/12/01]
\ProvidesPackage{transpect-meta}
    [\filedate \fileversion le-tex transpect meta module]
\RequirePackage{transpect-common}
\tpDeclareContainer{Meta}{%
  \tpDeclareType{Components}{%
    \tpDeclareRole[author]{Author}%
  }%
  \tpDeclareType{Properties}{%
    \tp@Meta@default
  }%
}
\def\tp@meta@generic@comp{%
  \tpDeclareComp{GenericMetaBlock}{\expandafter\global}{}%
  \tpDeclareComponentGroup{tpGenericMeta}{%
    \tpDeclareCountedComp{Heading}%
    \tpDeclareCountedComp{Content}%
  }}
\def\tp@meta@generic@eval{{%
  \def\tp@cur@cont{titlepage}%
  \tpComposeCollection{tpGenericMeta}{generic-meta-format}{GenericMetaBlock}
}}
\def\tpDeclareRole{\tp@opt@second\tp@declare@role}%
\def\tp@declare@role[#1]#2{%
  \tpDeclareRoleBlock{#2}{NameList}{list}{#1-format}%
  \tpDeclareRoleBlock{#2}{MetaBlock}{block}{#1-meta-format}%
  \tpDeclareComponentGroup{tp#2}{%
    \tpDeclareCountedComp{FullName}%
    \tpDeclareCountedComp{SurName}%
    \tpDeclareCountedComp{FirstName}%
    \tpDeclareCountedComp{MidName}%
    \tpDeclareCountedComp{PersonPrefix}%
    \tpDeclareCountedComp{PersonID}%
    \tpDeclareCountedComp{AffilID}%
    \tpDeclareCountedComp{Mail}%
    \tpDeclareCountedComp{Bio}%
  }}
\def\tp@meta@role@eval#1{{%
  \ifcsdef{tp#1-Cnt}
    {\tp@eval@role@attrs{#1}%
     \tpComposeCollection{tp#1}{\csname tp@meta@role@#1@block\endcsname}{#1MetaBlock}%
     \tpApplyCollection{tp#1}{\csname tp@meta@role@#1@list\endcsname}{#1NameList}}
    {}%
  \message{^^J===> \csname tp@meta@role@#1@list\endcsname: \expandafter\meaning\csname tp@meta@role@#1@list\endcsname}%
}}%
\def\tp@eval@role@attrs#1{%
    \tp@iterate{\@tempcnta}{\@ne}{\expandafter\the\csname tp#1-Cnt\endcsname}{%
      \expandafter\ifx\csname tp@meta@#1-\the\@tempcnta @attrs\endcsname\relax\else
        \tpParseAttributes{#1-\the\@tempcnta }{\csname tp@meta@#1-\the\@tempcnta @attrs\endcsname}%
      \fi
    }}
\def\tpDeclareRoleBlock#1#2#3#4{%
  \tpDeclareComp{#1#2}{\expandafter\global}{}%
  %\global\csletcs{tp#1#2}{#1#2}%
  \expandafter\gdef\csname tp@meta@role@#1@#3\endcsname{#4}%
}
\tpAddToDefault{Meta}{%
  \tpSetProperty{name-meta-format}{%
    \tpIfComp{Bio}
      {\tpUseComp{FullName}:\space%
       \tpUseComp{Bio}\par%
       \tpUseProperty{counted-meta-sep}}{}%
  }
  \tpSetProperty{name-format}{%
 %\expandafter\meaning\csname tp@\tp@cur@cont @FullName\endcsname
    \tpIfCompEmpty{FullName}{\tpComp{FullName}{\tpUseComp{FirstName}\space\tpUseComp{SurName}}}{}%
    \tpUseComp{FullName}%
    \tpUseProperty{counted-name-sep}%
  }
  \tpSetProperty{author-format}{\tpUseProperty{name-format}}% Override for single author names
  \tpSetProperty{author-meta-format}{\tpUseProperty{name-meta-format}}% Override for single author meta info
  \tpSetProperty{counted-meta-sep}{\ifnum\tpCurCount<\tpTotalCount\relax\vskip\baselineskip\fi}%
  \tpSetProperty{counted-name-sep}{%
    \ifnum\tpTotalCount>1\relax
      \ifnum\tpCurCount<\tpTotalCount\relax
        \ifnum\tpCurCount<\numexpr\tpTotalCount-1\relax
          \tpUseProperty{name-sep}%
        \else
          \tpUseProperty{name-and}%
        \fi
      \fi
    \fi
  }%
  \tpSetProperty{name-and}{\space and\space}%
  \tpSetProperty{name-etal}{\space et~al.}%
  \tpSetProperty{name-sep}{,\space}%
  \tpSetProperty{corresp-mark}{*}%
}
\endinput
%%
%% End of file `transpect-meta.sty'.
